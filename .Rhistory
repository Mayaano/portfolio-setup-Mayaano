# Boxplot of coefficients of variation by variable
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(title = "Coefficient of Variation by Variable",
x = "Variable", y = "Coefficient of Variation (MOE/Estimate)") +
theme_minimal()
quarto render assignments/assignment1/index.qmd --to html --no-cache
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(
title = "Distribution of Median Household Income by Tract",
x = "Median Household Income",
y = "Count of Tracts"
)
knitr::kable(tract_eval, caption = "Summary of Data Quality by Variable")
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(
title = "Coefficient of Variation by Variable",
x = "Variable",
y = "Coefficient of Variation (MOE/Estimate)"
) +
theme_minimal()
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
library(ggplot2)
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
library(dplyr)
library(ggplot2)
library(scales)
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
library(dplyr)
library(ggplot2)
library(scales)
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(
title = "Distribution of Median Household Income by Tract",
x = "Median Household Income",
y = "Count of Tracts"
)
knitr::kable(tract_eval, caption = "Summary of Data Quality by Variable")
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(
title = "Coefficient of Variation by Variable",
x = "Variable",
y = "Coefficient of Variation (MOE/Estimate)"
) +
theme_minimal()
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
library(dplyr)
library(ggplot2)
library(scales)
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(
title = "Distribution of Median Household Income by Tract",
x = "Median Household Income",
y = "Count of Tracts"
)
knitr::kable(tract_eval, caption = "Summary of Data Quality by Variable")
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(
title = "Coefficient of Variation by Variable",
x = "Variable",
y = "Coefficient of Variation (MOE/Estimate)"
) +
theme_minimal()
library(dplyr)
library(ggplot2)
library(scales)
library(tidycensus)
library(knitr)
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(
title = "Distribution of Median Household Income by Tract",
x = "Median Household Income",
y = "Count of Tracts"
)
knitr::kable(tract_eval, caption = "Summary of Data Quality by Variable")
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(
title = "Coefficient of Variation by Variable",
x = "Variable",
y = "Coefficient of Variation (MOE/Estimate)"
) +
theme_minimal()
library(dplyr)
library(ggplot2)
library(scales)
library(tidycensus)
library(knitr)
vars <- c(
total_pop = "B01003_001",
median_income = "B19013_001",
median_age = "B01002_001"
)
county_data <- get_acs(
geography = "county",
state = "PA",
variables = vars,
year = 2022
)
county_wide <- county_data %>%
select(GEOID, NAME, variable, estimate) %>%
tidyr::pivot_wider(names_from = variable, values_from = estimate)
library(dplyr)
library(ggplot2)
library(scales)
library(tidycensus)
library(knitr)
vars <- c(
total_pop = "B01003_001",
median_income = "B19013_001",
median_age = "B01002_001"
)
county_data <- get_acs(
geography = "county",
state = "PA",
variables = vars,
year = 2022
)
county_wide <- county_data %>%
select(GEOID, NAME, variable, estimate) %>%
tidyr::pivot_wider(names_from = variable, values_from = estimate)
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
library(dplyr)
library(ggplot2)
library(scales)
library(tidycensus)
library(knitr)
vars <- c(
total_pop = "B01003_001",
median_income = "B19013_001",
median_age = "B01002_001"
)
county_data <- get_acs(
geography = "county",
state = "PA",
variables = vars,
year = 2022
)
county_wide <- county_data %>%
select(GEOID, NAME, variable, estimate) %>%
tidyr::pivot_wider(names_from = variable, values_from = estimate)
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
library(dplyr)
library(ggplot2)
library(scales)
library(tidycensus)
library(knitr)
vars <- c(
total_pop = "B01003_001",
median_income = "B19013_001",
median_age = "B01002_001"
)
county_data <- get_acs(
geography = "county",
state = "PA",
variables = vars,
year = 2022
)
county_wide <- county_data %>%
select(GEOID, NAME, variable, estimate) %>%
tidyr::pivot_wider(names_from = variable, values_from = estimate)
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(
title = "Distribution of Median Household Income by Tract",
x = "Median Household Income",
y = "Count of Tracts"
)
knitr::kable(tract_eval, caption = "Summary of Data Quality by Variable")
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(
title = "Coefficient of Variation by Variable",
x = "Variable",
y = "Coefficient of Variation (MOE/Estimate)"
) +
theme_minimal()
library(dplyr)
library(ggplot2)
library(scales)
library(tidycensus)
library(knitr)
vars <- c(
total_pop = "B01003_001",
median_income = "B19013_001",
median_age = "B01002_001"
)
county_data <- get_acs(
geography = "county",
state = "PA",
variables = vars,
year = 2022
)
county_wide <- county_data %>%
select(GEOID, NAME, variable, estimate) %>%
tidyr::pivot_wider(names_from = variable, values_from = estimate)
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
knitr::kable(head(county_wide), caption = "Sample of County-Level Data")
ggplot(county_wide, aes(x = reorder(NAME, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(axis.text.y = element_text(size = 6))
tract_data <- get_acs(
geography = "tract",
state = "PA",
county = "Philadelphia",
variables = vars,
year = 2022
)
tract_wide <- tract_data %>%
select(GEOID, NAME, variable, estimate) %>%
tidyr::pivot_wider(names_from = variable, values_from = estimate)
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
knitr::kable(head(tract_wide), caption = "Sample of Tract-Level Data (Philadelphia)")
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(
title = "Distribution of Median Household Income by Tract",
x = "Median Household Income",
y = "Count of Tracts"
)
knitr::kable(tract_eval, caption = "Summary of Data Quality by Variable")
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(
title = "Coefficient of Variation by Variable",
x = "Variable",
y = "Coefficient of Variation (MOE/Estimate)"
) +
theme_minimal()
library(tidyverse)
library(tidycensus)
library(scales)
library(RColorBrewer)
census_api_key(Sys.getenv("CENSUS_API_KEY"), install = FALSE)
acs_vars_2022 <- load_variables(2022, "acs5", cache = TRUE)
head(acs_vars_2022)
vars <- c(
total_pop = "B01003_001",
median_income = "B19013_001",
median_age = "B01002_001"
)
county_data <- get_acs(
geography = "county",
state = "PA",
variables = vars,
year = 2022
)
county_wide <- county_data %>%
select(GEOID, NAME, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)
head(county_wide)
colnames(county_wide)
library(dplyr)
library(ggplot2)
library(scales)
print(class(county_wide))
print(head(county_wide))
print(colnames(county_wide))
library(dplyr)
library(ggplot2)
library(scales)
county_wide <- county_wide %>%
mutate(NAME_short = gsub(", Pennsylvania", "", NAME))
ggplot(county_wide, aes(x = reorder(NAME_short, median_income), y = median_income)) +
geom_col(fill = "steelblue") +
coord_flip() +
scale_y_continuous(labels = dollar) +
labs(
title = "Median Household Income by County (PA, 2022)",
x = "County",
y = "Median Household Income"
) +
theme(
axis.text.y = element_text(size = 5),
plot.title = element_text(hjust = 0.5)
)
tract_data <- get_acs(
geography = "tract",
state = "PA",
county = "Philadelphia",
variables = vars,
year = 2022
)
tract_wide <- tract_data %>%
select(GEOID, NAME, variable, estimate) %>%
pivot_wider(names_from = variable, values_from = estimate)
head(tract_wide)
# Histogram of tract-level median income
ggplot(tract_wide, aes(x = median_income)) +
geom_histogram(fill = "darkgreen", bins = 30, alpha = 0.7) +
scale_x_continuous(labels = dollar) +
labs(title = "Distribution of Median Household Income by Tract",
x = "Median Household Income", y = "Count of Tracts")
tract_eval <- tract_data %>%
mutate(cv = moe / estimate) %>%
group_by(variable) %>%
summarize(
avg_cv = mean(cv, na.rm = TRUE),
high_moe = sum(cv > 0.15, na.rm = TRUE),
.groups = "drop"
)
tract_eval
# Boxplot of coefficients of variation by variable
tract_data %>%
mutate(cv = moe / estimate) %>%
ggplot(aes(x = variable, y = cv, fill = variable)) +
geom_boxplot() +
scale_y_continuous(labels = percent) +
labs(title = "Coefficient of Variation by Variable",
x = "Variable", y = "Coefficient of Variation (MOE/Estimate)") +
theme_minimal()
# Map them
ggplot(neighbors) +
geom_sf() +
theme_void()
# Counties within 50km of Allegheny centroid
allegheny_center <- st_centroid(allegheny)
# With ggplot2
ggplot(tracts_in_allegheny) +
geom_sf() +
theme_void()
metro_tracts<- census_tracts %>%
st_filter(metro_areas, .predicate = st_intersects)
View(tract_eval)
ggplot(districts_with_data) +
geom_sf(aes(fill = total_population), color = "white", size = 0.5) +
scale_fill_viridis_c(
name = "Population",
labels = comma,  # Format with commas
option = "plasma"  # Color scheme
) +
labs(
title = "Population by District",
subtitle = "Total population from census tracts",
caption = "Source: ACS 2018-2022"
) +
theme_void()
# From a URL
#https://data-pennshare.opendata.arcgis.com/datasets/pennsylvania-state-boundary/explore
#click on "I want to use this (bottom)"
# From a URL
#https://data-pennshare.opendata.arcgis.com/datasets/pennsylvania-state-boundary/explore
#click on "I want to use this (bottom)"
# From a URL
#https://data-pennshare.opendata.arcgis.com/datasets/pennsylvania-state-boundary/explore
#click on "I want to use this (bottom)"
#get census tracts (boundaries only) using the tigris package
census_tracts <- tracts(state = "PA", cb = TRUE)
#get census tracts (boundaries only) using the tigris package
census_tracts <- tracts(state = "PA", cb = TRUE)
#get census tracts (boundaries only) using the tigris package
census_tracts <- tracts(state = "PA", cb = TRUE)
# Get urban areas (Census Bureau definition)
# These are areas with 2,500+ people
metro_areas <- core_based_statistical_areas(cb = TRUE)
ggplot(districts_with_data) +
geom_sf(aes(fill = total_population), color = "white", size = 0.5) +
scale_fill_viridis_c(
name = "Population",
labels = comma,  # Format with commas
option = "plasma"  # Color scheme
) +
labs(
title = "Population by District",
subtitle = "Total population from census tracts",
caption = "Source: ACS 2018-2022"
) +
theme_void()
source("D:/pen/MUSA5080PublicPolicyAnalytics/MUSA-5080-Fall-2025-main/lectures/MUSA-5080-Fall-2025 MUSA-5080-Fall-2025 main lectures-week-04/scripts/Week4_lecture_codes.R")

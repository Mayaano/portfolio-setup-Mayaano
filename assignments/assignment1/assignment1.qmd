---
title: "Assignment 1: Census Data Quality for Policy Decisions"
subtitle: "Evaluating Data Reliability for Algorithmic Decision-Making"
author: "Zhe Fang"
date: today
format: 
  html:
    code-fold: true
    code-tools:
      source: true
      toggle: false
    toc: true
    toc-location: right
    theme: cosmo
execute:
  warning: false
  message: false
---

# Assignment Overview

## Scenario

You are a data analyst for the **Pennsylvania Department of Human Services**. The department is considering implementing an algorithmic system to identify communities that should receive priority for social service funding and outreach programs. Your supervisor has asked you to evaluate the quality and reliability of available census data to inform this decision.

Drawing on our Week 2 discussion of algorithmic bias, you need to assess not just what the data shows, but how reliable it is and what communities might be affected by data quality issues.

## Learning Objectives

- Apply dplyr functions to real census data for policy analysis
- Evaluate data quality using margins of error 
- Connect technical analysis to algorithmic decision-making
- Identify potential equity implications of data reliability issues
- Create professional documentation for policy stakeholders

# Setup

```{r setup}
#| include: false

# Load required packages
library(tidycensus)
library(tidyverse)
library(knitr)
library(kableExtra)
library(scales)

# Set Census API key
census_api_key(Sys.getenv("CENSUS_API_KEY"), install = FALSE)

# Choose state
my_state <- "PA"
```

**State Selection:** I have chosen **Pennsylvania** for this analysis because it represents a diverse mix of urban, suburban, and rural communities. This diversity makes it an ideal case study for examining how data quality varies across different types of geographies and how these variations might affect algorithmic decision-making systems.

# Part 2: County-Level Resource Assessment

## 2.1 Data Retrieval

```{r county-data}
# Get county-level data
county_data <- get_acs(
  geography = "county",
  state = my_state,
  variables = c(
    median_income = "B19013_001",
    total_pop = "B01003_001"
  ),
  year = 2022,
  survey = "acs5",
  output = "wide"
)

# Clean county names
county_data <- county_data %>%
  mutate(
    county_name = str_remove(NAME, ", Pennsylvania"),
    county_name = str_remove(county_name, " County")
  )

# Display first few rows
head(county_data) %>%
  select(county_name, median_incomeE, median_incomeM, total_popE, total_popM) %>%
  kable(
    col.names = c("County", "Median Income", "Income MOE", "Population", "Pop MOE"),
    format.args = list(big.mark = ","),
    caption = "Sample of Pennsylvania County Data (2022 ACS 5-Year Estimates)"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

## 2.2 Data Quality Assessment

```{r income-reliability}
# Calculate MOE percentages and create reliability categories
county_reliability <- county_data %>%
  mutate(
    moe_pct = (median_incomeM / median_incomeE) * 100,
    reliability = case_when(
      moe_pct < 5 ~ "High Confidence",
      moe_pct >= 5 & moe_pct < 10 ~ "Moderate Confidence",
      moe_pct >= 10 ~ "Low Confidence"
    ),
    reliability = factor(reliability, 
                        levels = c("High Confidence", "Moderate Confidence", "Low Confidence")),
    unreliable = moe_pct > 10
  )

# Summary of reliability categories
reliability_summary <- county_reliability %>%
  count(reliability) %>%
  mutate(percentage = round((n / sum(n)) * 100, 1))

reliability_summary %>%
  kable(
    col.names = c("Reliability Category", "Number of Counties", "Percentage"),
    caption = "Distribution of Data Reliability Across Pennsylvania Counties"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Most Pennsylvania counties have high-quality income data. Out of `r nrow(county_reliability)` counties, `r reliability_summary$n[1]` (`r reliability_summary$percentage[1]`%) have high confidence estimates, while only `r sum(county_reliability$unreliable)` counties show low confidence. This suggests county-level median income is generally reliable for algorithmic decision-making in Pennsylvania.

## 2.3 High Uncertainty Counties

```{r high-uncertainty}
# Identify top 5 counties with highest MOE
high_moe_counties <- county_reliability %>%
  arrange(desc(moe_pct)) %>%
  slice(1:5) %>%
  select(county_name, median_incomeE, median_incomeM, moe_pct, reliability)

high_moe_counties %>%
  kable(
    col.names = c("County", "Median Income", "Margin of Error", "MOE %", "Reliability"),
    format.args = list(big.mark = ","),
    digits = c(0, 0, 0, 2, 0),
    caption = "Top 5 Pennsylvania Counties with Highest Data Uncertainty"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

**Data Quality Commentary:**

The counties with the highest MOE percentages tend to be smaller, rural counties. This pattern raises important concerns for algorithmic decision-making. If an algorithm prioritizes communities based on median income alone, these high-uncertainty counties might be misclassified. For example, a county's true median income could be several thousand dollars higher or lower than the estimate suggests.

This uncertainty isn't random—it systematically affects rural communities more than urban ones. Any algorithm deployment must account for this geographic bias in data quality, or risk systematically misallocating resources away from rural areas that may actually need support.

# Part 3: Neighborhood-Level Analysis

## 3.1 Focus Area Selection

```{r select-counties}
# Select counties representing different reliability levels
selected_counties <- county_reliability %>%
  filter(
    county_name %in% c("Philadelphia", "Centre", "Forest")
  ) %>%
  select(county_name, GEOID, median_incomeE, moe_pct, reliability, total_popE) %>%
  arrange(desc(total_popE))

selected_counties %>%
  kable(
    col.names = c("County", "GEOID", "Median Income", "MOE %", "Reliability", "Population"),
    format.args = list(big.mark = ","),
    digits = c(0, 0, 0, 2, 0, 0),
    caption = "Selected Counties for Detailed Analysis"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

I selected three counties that represent different contexts: **Philadelphia** (large urban, high confidence data), **Centre** (mid-size with university, moderate confidence), and **Forest** (small rural, lower confidence). This range allows us to examine how data quality varies across Pennsylvania's diverse geography.

## 3.2 Tract-Level Demographics

```{r tract-demographics}
# Extract county codes
county_codes <- str_sub(selected_counties$GEOID, 3, 5)

# Get tract-level demographic data
tract_demo <- get_acs(
  geography = "tract",
  state = my_state,
  county = county_codes,
  variables = c(
    total_pop = "B03002_001",
    white = "B03002_003",
    black = "B03002_004",
    hispanic = "B03002_012"
  ),
  year = 2022,
  survey = "acs5",
  output = "wide"
)

# Calculate percentages
tract_demo <- tract_demo %>%
  mutate(
    county_name = case_when(
      str_detect(NAME, "Philadelphia") ~ "Philadelphia",
      str_detect(NAME, "Centre") ~ "Centre",
      str_detect(NAME, "Forest") ~ "Forest"
    ),
    pct_white = (whiteE / total_popE) * 100,
    pct_black = (blackE / total_popE) * 100,
    pct_hispanic = (hispanicE / total_popE) * 100,
    # Calculate MOE percentages
    moe_white = (whiteM / whiteE) * 100,
    moe_black = (blackM / blackE) * 100,
    moe_hispanic = (hispanicM / hispanicE) * 100
  )
```

## 3.3 Demographic Analysis

```{r demographic-analysis}
# Find tract with highest Hispanic percentage
highest_hispanic <- tract_demo %>%
  arrange(desc(pct_hispanic)) %>%
  slice(1) %>%
  select(NAME, county_name, pct_hispanic, hispanicE, hispanicM, moe_hispanic)

highest_hispanic %>%
  kable(
    col.names = c("Census Tract", "County", "% Hispanic", "Hispanic Pop", "MOE", "MOE %"),
    digits = c(0, 0, 1, 0, 0, 1),
    caption = "Census Tract with Highest Hispanic/Latino Percentage"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

# Calculate county-level averages
county_demographics <- tract_demo %>%
  group_by(county_name) %>%
  summarize(
    n_tracts = n(),
    avg_pct_white = mean(pct_white, na.rm = TRUE),
    avg_pct_black = mean(pct_black, na.rm = TRUE),
    avg_pct_hispanic = mean(pct_hispanic, na.rm = TRUE),
    .groups = "drop"
  )

county_demographics %>%
  kable(
    col.names = c("County", "Number of Tracts", "Avg % White", "Avg % Black", "Avg % Hispanic"),
    digits = c(0, 0, 1, 1, 1),
    caption = "Average Demographics by County"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

Philadelphia shows the most demographic diversity, while Forest County's population is predominantly white. These differences matter for algorithmic systems because if data quality varies by racial composition, the algorithm could systematically perform worse in diverse communities.

# Part 4: Comprehensive Data Quality Evaluation

## 4.1 MOE Analysis for Demographic Variables

```{r demographic-moe}
# Flag tracts with high MOE on any demographic variable
tract_demo <- tract_demo %>%
  mutate(
    high_moe = (moe_white > 15 | moe_black > 15 | moe_hispanic > 15)
  )

# Summary statistics
moe_summary <- tract_demo %>%
  summarize(
    total_tracts = n(),
    tracts_with_high_moe = sum(high_moe, na.rm = TRUE),
    pct_high_moe = round((tracts_with_high_moe / total_tracts) * 100, 1)
  )

cat("Total tracts analyzed:", moe_summary$total_tracts, "\n")
cat("Tracts with high MOE (>15%) on any demographic variable:", 
    moe_summary$tracts_with_high_moe, 
    "(", moe_summary$pct_high_moe, "%)\n")
```

About `r moe_summary$pct_high_moe`% of tracts have unreliable data for at least one demographic group. This is a significant proportion and suggests that tract-level demographic data requires careful handling in any algorithmic system.

## 4.2 Pattern Analysis

```{r pattern-analysis}
# Compare characteristics of tracts with/without data quality issues
pattern_analysis <- tract_demo %>%
  group_by(high_moe) %>%
  summarize(
    n_tracts = n(),
    avg_population = mean(total_popE, na.rm = TRUE),
    avg_pct_white = mean(pct_white, na.rm = TRUE),
    avg_pct_black = mean(pct_black, na.rm = TRUE),
    avg_pct_hispanic = mean(pct_hispanic, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(
    high_moe = ifelse(high_moe, "High MOE (>15%)", "Acceptable MOE (≤15%)")
  )

pattern_analysis %>%
  kable(
    col.names = c("Data Quality", "N Tracts", "Avg Pop", "% White", "% Black", "% Hispanic"),
    digits = c(0, 0, 0, 1, 1, 1),
    format.args = list(big.mark = ","),
    caption = "Comparison of Tract Characteristics by Data Quality"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

**Pattern Analysis:** 

Tracts with high MOE issues have significantly smaller populations (averaging `r round(pattern_analysis$avg_population[pattern_analysis$high_moe == "High MOE (>15%)"], 0)` people) compared to reliable tracts (`r round(pattern_analysis$avg_population[pattern_analysis$high_moe == "Acceptable MOE (≤15%)"], 0)` people). This confirms that data quality problems concentrate in low-population areas.

Importantly, we don't see dramatic differences in racial composition between high-MOE and low-MOE tracts, which is somewhat reassuring. However, the systematic bias toward small communities remains problematic—any algorithm that doesn't account for this could systematically disadvantage rural neighborhoods regardless of their actual needs.

# Part 5: Policy Recommendations

## 5.1 Analysis Integration and Professional Summary

**Executive Summary:**

**Overall Pattern:** Across Pennsylvania, census data quality follows a clear geographic pattern. County-level estimates are highly reliable for most jurisdictions, with `r reliability_summary$percentage[1]`% of counties showing high confidence intervals. However, as we zoom into tract-level data, reliability degrades significantly in small-population areas. Approximately `r moe_summary$pct_high_moe`% of census tracts have unreliable demographic estimates, with margins of error exceeding 15%.

**Equity Assessment:** The most vulnerable communities to algorithmic bias are rural, low-population tracts—particularly those in counties like Forest, which have fewer than 2,000 residents per tract on average. If an algorithm relies on tract-level demographic or economic data without accounting for margins of error, it will systematically make worse decisions for these communities. This isn't a random error—it's a structural bias that could perpetuate rural disadvantage.

**Root Cause Analysis:** The fundamental issue is sample size. The American Community Survey samples households, so areas with fewer people yield less precise estimates. This is an unavoidable statistical reality, not a flaw in the Census Bureau's methods. However, when algorithms treat all estimates as equally valid, they amplify this inherent data quality variance into decision-making bias.

**Strategic Recommendations:** The Department should not abandon algorithmic tools but must implement a tiered approach: use county-level data for initial screening, flag high-MOE communities for manual review, supplement ACS data with administrative records in uncertain areas, and conduct regular equity audits post-deployment. Most critically, the algorithm must incorporate uncertainty—treating a point estimate with a 20% margin of error differently than one with a 2% margin.

## 5.2 Specific Recommendations

```{r recommendations-data}
# Create decision framework
county_recommendations <- county_reliability %>%
  mutate(
    recommendation = case_when(
      reliability == "High Confidence" ~ "Safe for algorithmic decisions",
      reliability == "Moderate Confidence" ~ "Use with caution - monitor outcomes",
      reliability == "Low Confidence" ~ "Requires manual review or additional data"
    )
  ) %>%
  select(county_name, median_incomeE, moe_pct, reliability, recommendation) %>%
  arrange(moe_pct)

# Display counties requiring special attention
county_recommendations %>%
  filter(reliability %in% c("Moderate Confidence", "Low Confidence")) %>%
  kable(
    col.names = c("County", "Median Income", "MOE %", "Reliability", "Recommendation"),
    format.args = list(big.mark = ","),
    digits = c(0, 0, 2, 0, 0),
    caption = "Counties Requiring Special Consideration for Algorithm Implementation"
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```

**Key Recommendations:**

**1. Counties suitable for immediate algorithmic implementation:** Philadelphia, Allegheny, Montgomery, Delaware, and Bucks counties all show high confidence data (MOE < 5%). These large, populous counties have sufficient sample sizes for reliable estimates. Algorithms can safely use census data for initial resource allocation decisions in these areas.

**2. Counties requiring additional oversight:** Chester, Berks, and Lancaster counties fall in the moderate confidence range. While their data isn't unreliable, the Department should monitor algorithm performance in these areas more carefully. Consider supplementing ACS estimates with local administrative data (SNAP enrollment, Medicaid applications, etc.) to validate algorithmic recommendations.

**3. Counties needing alternative approaches:** Forest, Sullivan, and Cameron counties have low confidence estimates. For these small, rural counties, the Department should either aggregate to multi-county regions for more stable estimates, or rely primarily on manual case review rather than algorithmic screening. Alternatively, consider using 100% count data from the decennial Census (though less current) or administrative records that capture the full population.

## Questions for Further Investigation

1. How do data quality patterns change over time? Are there counties where reliability improved or worsened between 2018-2022 and 2014-2018 ACS periods?

2. For tract-level analysis, would aggregating Census tracts into neighborhoods or zip codes provide a better balance between geographic specificity and data reliability?

3. Can we identify specific demographic or economic variables that maintain reliability even in small-population areas, which could serve as more robust algorithmic inputs?

# Technical Notes

**Data Sources:** 
- U.S. Census Bureau, American Community Survey 2018-2022 5-Year Estimates
- Retrieved via tidycensus R package on `r format(Sys.Date(), "%B %d, %Y")`

**Reproducibility:** 
- All analysis conducted in R version `r paste(R.version$major, R.version$minor, sep = ".")`
- Census API key required for replication
- Complete code available in this document (use "View Source" button)

**Methodology Notes:**

I chose Pennsylvania for its demographic and geographic diversity, which provides a comprehensive test case for data quality issues. County selection for detailed tract analysis (Philadelphia, Centre, Forest) was designed to span the urban-rural spectrum and reliability ranges.

For reliability categories, I used standard thresholds: <5% MOE for high confidence, 5-10% for moderate, and >10% for low. These are conservative but appropriate for policy decisions with significant resource implications.

**Limitations:**

This analysis focuses only on median household income and demographic variables. Other ACS indicators (employment, housing characteristics, education) may show different reliability patterns. Additionally, margins of error assume normal distributions, which may not hold for highly skewed variables.

The analysis is limited to 2022 ACS 5-year estimates. Data quality may vary by time period, and some conclusions might differ using 1-year estimates (which have higher MOEs but more current data).

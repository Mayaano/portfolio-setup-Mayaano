{
  "hash": "77af3ffebae0315323ffbbfe7f098a7f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"EDA: Philadelphia Eviction Data Analysis\"\nsubtitle: \"MUSA 5080 Final Project - Comprehensive Exploratory Analysis\"\nauthor: \"Fang Zhe\"\ndate: today\nformat:\n  html:\n    toc: true\n    toc-depth: 3\n    code-fold: true\n    theme: cosmo\n    self-contained: true\nexecute:\n  warning: false\n  message: false\n---\n\n# Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(tigris)\nlibrary(viridis)\nlibrary(corrplot)\nlibrary(knitr)\nlibrary(kableExtra)\nlibrary(lubridate)\nlibrary(readxl)\nlibrary(scales)\nlibrary(patchwork)\nlibrary(spdep)  # For spatial autocorrelation\n\noptions(scipen = 999)\noptions(tigris_use_cache = TRUE)\n\n# Custom plot themes\nplotTheme <- theme_minimal() +\n  theme(\n    plot.title = element_text(size = 14, face = \"bold\"),\n    plot.subtitle = element_text(size = 10, color = \"grey40\"),\n    axis.title = element_text(size = 10),\n    axis.text = element_text(size = 9),\n    legend.position = \"right\",\n    panel.grid.minor = element_blank()\n  )\n\nmapTheme <- theme_void() +\n  theme(\n    plot.title = element_text(size = 14, face = \"bold\"),\n    plot.subtitle = element_text(size = 10, color = \"grey40\"),\n    legend.position = \"right\"\n  )\n\n# Color palettes\neviction_color <- \"#e31a1c\"\nunemp_color <- \"#1f78b4\"\ncpi_color <- \"#33a02c\"\n```\n:::\n\n\n---\n\n# Part 1: Data Loading\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load all datasets\nchanges_claims <- read.csv(\"eviction_data/changes_claims.csv\")\ndemographics <- read.csv(\"eviction_data/demographics.csv\")\neviction_hotspots <- read.csv(\"eviction_data/eviction_hotspots.csv\")\nfilings_baseline <- read.csv(\"eviction_data/filings_relative_baseline.csv\")\ntract_filings <- read.csv(\"eviction_data/tract_level_filings.csv\")\ntract_filing_rate <- read.csv(\"eviction_data/tract_level_filing_rate.csv\")\neviction_trends <- read.csv(\"eviction_data/trends_eviction.csv\")\n\n# Load Excel files\nunemployment <- read_xlsx(\"eviction_data/unemployment_rate_montly.xlsx\")\ncpi <- read_xlsx(\"eviction_data/consumer_price_index_monthly.xlsx\")\nfinancial_health <- read_xlsx(\"eviction_data/financial-health-of-residents-data.xlsx\")\n\n# Data summary\ncat(\"=== Data Loading Summary ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n=== Data Loading Summary ===\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Eviction trends:\", nrow(eviction_trends), \"months\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEviction trends: 70 months\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Tract-level filings:\", nrow(tract_filings), \"observations\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTract-level filings: 408 observations\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Tract filing rates:\", nrow(tract_filing_rate), \"observations\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTract filing rates: 408 observations\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Eviction hotspots:\", nrow(eviction_hotspots), \"locations\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEviction hotspots: 75 locations\n```\n\n\n:::\n:::\n\n\n---\n\n# Part 2: Eviction Trends Over Time\n\n## 2.1 Monthly Eviction Filings\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Parse date from eviction_trends\neviction_trends_clean <- eviction_trends %>%\n  mutate(\n    month_num = as.integer(substr(month, 1, 2)),\n    year = as.integer(substr(month, 4, 7)),\n    date = as.Date(paste0(year, \"-\", month_num, \"-01\"))\n  ) %>%\n  arrange(date)\n\ncat(\"Eviction data:\", nrow(eviction_trends_clean), \"months\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEviction data: 70 months\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Date range:\", as.character(min(eviction_trends_clean$date)), \"to\", \n    as.character(max(eviction_trends_clean$date)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDate range: 2020-01-01 to 2025-10-01 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Plot monthly filings over time\nggplot(eviction_trends_clean, aes(x = date, y = month_filings)) +\n  geom_line(color = eviction_color, linewidth = 1) +\n  geom_point(color = eviction_color, size = 2) +\n  geom_hline(yintercept = mean(eviction_trends_clean$month_filings, na.rm = TRUE), \n             linetype = \"dashed\", color = \"grey50\", alpha = 0.7) +\n  annotate(\"text\", x = min(eviction_trends_clean$date), \n           y = mean(eviction_trends_clean$month_filings, na.rm = TRUE) + 100,\n           label = paste(\"Average:\", round(mean(eviction_trends_clean$month_filings, na.rm = TRUE), 0)),\n           hjust = 0, color = \"grey50\", size = 3.5) +\n  labs(\n    title = \"Monthly Eviction Filings in Philadelphia\",\n    subtitle = \"Tracking eviction activity over time\",\n    x = \"Date\",\n    y = \"Number of Filings\"\n  ) +\n  scale_y_continuous(labels = comma) +\n  scale_x_date(date_breaks = \"6 months\", date_labels = \"%b %Y\") +\n  plotTheme +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/trends_time-1.png){width=672}\n:::\n:::\n\n\n## 2.2 Eviction Filings vs Baseline\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Identify periods above/below baseline\neviction_trends_clean <- eviction_trends_clean %>%\n  mutate(above_baseline = percentage_diff > 0)\n\nggplot(eviction_trends_clean, aes(x = date, y = percentage_diff)) +\n  geom_area(aes(fill = above_baseline), alpha = 0.3) +\n  geom_line(color = \"grey30\", linewidth = 0.8) +\n  geom_point(aes(color = above_baseline), size = 2) +\n  geom_hline(yintercept = 0, linetype = \"dashed\", color = \"black\", linewidth = 1) +\n  scale_fill_manual(values = c(\"TRUE\" = eviction_color, \"FALSE\" = unemp_color), guide = \"none\") +\n  scale_color_manual(values = c(\"TRUE\" = eviction_color, \"FALSE\" = unemp_color), guide = \"none\") +\n  labs(\n    title = \"Eviction Filings Relative to Pre-Pandemic Baseline\",\n    subtitle = \"Red = above baseline, Blue = below baseline\",\n    x = \"Date\",\n    y = \"Percentage Difference from Baseline (%)\"\n  ) +\n  scale_x_date(date_breaks = \"6 months\", date_labels = \"%b %Y\") +\n  plotTheme +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/baseline_comparison-1.png){width=672}\n:::\n:::\n\n\n## 2.3 Year-over-Year Comparison\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Year-over-year comparison\neviction_yoy <- eviction_trends_clean %>%\n  mutate(month_name = month(date, label = TRUE)) %>%\n  group_by(year, month_name) %>%\n  summarize(filings = sum(month_filings, na.rm = TRUE), .groups = \"drop\")\n\nggplot(eviction_yoy, aes(x = month_name, y = filings, color = factor(year), group = year)) +\n  geom_line(linewidth = 1) +\n  geom_point(size = 2) +\n  scale_color_brewer(palette = \"Set1\", name = \"Year\") +\n  labs(\n    title = \"Eviction Filings by Month: Year-over-Year Comparison\",\n    subtitle = \"Seasonal patterns and annual changes\",\n    x = \"Month\",\n    y = \"Filings\"\n  ) +\n  scale_y_continuous(labels = comma) +\n  plotTheme\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/yoy_comparison-1.png){width=672}\n:::\n:::\n\n\n---\n\n# Part 3: Economic Indicators Analysis\n\n## 3.1 Unemployment Rate Trend\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean unemployment data - header is in row 11 (R 1-indexed)\n# Use manual column names to avoid duplicate issues\nunemp_clean <- unemployment[-(1:11), ]\ncolnames(unemp_clean) <- c(\"Year\", \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \n                            \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")\n\nmonth_names <- c(\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\")\n\nunemp_long <- unemp_clean %>%\n  mutate(Year = as.integer(as.numeric(Year))) %>%\n  pivot_longer(cols = all_of(month_names),\n               names_to = \"month_name\",\n               values_to = \"unemployment_rate\") %>%\n  mutate(\n    unemployment_rate = as.numeric(unemployment_rate),\n    month_num = match(month_name, month_names),\n    date = as.Date(paste0(Year, \"-\", month_num, \"-01\"))\n  ) %>%\n  filter(!is.na(unemployment_rate)) %>%\n  arrange(date)\n\ncat(\"Unemployment data:\", nrow(unemp_long), \"observations\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nUnemployment data: 116 observations\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Date range:\", as.character(min(unemp_long$date)), \"to\", as.character(max(unemp_long$date)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nDate range: 2016-01-01 to 2025-08-01 \n```\n\n\n:::\n\n```{.r .cell-code}\nggplot(unemp_long, aes(x = date, y = unemployment_rate)) +\n  geom_line(color = unemp_color, linewidth = 1) +\n  geom_point(color = unemp_color, size = 1.5) +\n  geom_vline(xintercept = as.Date(\"2020-03-01\"), linetype = \"dashed\", color = \"red\", alpha = 0.7) +\n  annotate(\"text\", x = as.Date(\"2020-03-01\"), y = max(unemp_long$unemployment_rate, na.rm = TRUE),\n           label = \"COVID-19\", hjust = -0.1, color = \"red\", size = 3) +\n  labs(\n    title = \"Philadelphia Unemployment Rate Over Time\",\n    subtitle = \"Economic disruption indicator\",\n    x = \"Date\",\n    y = \"Unemployment Rate (%)\"\n  ) +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  plotTheme\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/unemployment_trend-1.png){width=672}\n:::\n:::\n\n\n## 3.2 Consumer Price Index (CPI) Trend\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean CPI data - header is in row 12 (R 1-indexed)\n# CPI has 16 columns: Year + 12 months + Annual + HALF1 + HALF2\ncpi_clean <- cpi[-(1:12), 1:13]  # Only keep Year + 12 months\ncolnames(cpi_clean) <- c(\"Year\", \"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \n                          \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\")\n\ncpi_long <- cpi_clean %>%\n  mutate(Year = as.integer(as.numeric(Year))) %>%\n  pivot_longer(cols = all_of(month_names),\n               names_to = \"month_name\",\n               values_to = \"cpi_value\") %>%\n  mutate(\n    cpi_value = as.numeric(cpi_value),\n    month_num = match(month_name, month_names),\n    date = as.Date(paste0(Year, \"-\", month_num, \"-01\"))\n  ) %>%\n  filter(!is.na(cpi_value)) %>%\n  arrange(date)\n\ncat(\"CPI data:\", nrow(cpi_long), \"observations\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCPI data: 58 observations\n```\n\n\n:::\n\n```{.r .cell-code}\n# Calculate YoY inflation\ncpi_long <- cpi_long %>%\n  mutate(cpi_yoy_change = (cpi_value / lag(cpi_value, 12) - 1) * 100)\n\nggplot(cpi_long %>% filter(!is.na(cpi_yoy_change)), aes(x = date, y = cpi_yoy_change)) +\n  geom_line(color = cpi_color, linewidth = 1) +\n  geom_hline(yintercept = 2, linetype = \"dashed\", color = \"grey50\") +\n  annotate(\"text\", x = min(cpi_long$date, na.rm = TRUE) + 365, y = 2.3,\n           label = \"2% Target\", color = \"grey50\", size = 3) +\n  labs(\n    title = \"Year-over-Year Inflation Rate (CPI)\",\n    subtitle = \"Philadelphia Metro Area\",\n    x = \"Date\",\n    y = \"Inflation Rate (%)\"\n  ) +\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  plotTheme\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/cpi_trend-1.png){width=672}\n:::\n:::\n\n\n## 3.3 ⭐ Key Chart: Economic Disruption vs Evictions (Dual Y-Axis)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Merge eviction trends with economic indicators\neviction_econ <- eviction_trends_clean %>%\n  left_join(unemp_long %>% select(date, unemployment_rate), by = \"date\") %>%\n  left_join(cpi_long %>% select(date, cpi_value), by = \"date\")\n\n# Check merge results\ncat(\"Total eviction months:\", nrow(eviction_trends_clean), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTotal eviction months: 70 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"Months with unemployment data:\", sum(!is.na(eviction_econ$unemployment_rate)), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nMonths with unemployment data: 68 \n```\n\n\n:::\n\n```{.r .cell-code}\n# If no overlap, create stacked plots\nif(sum(!is.na(eviction_econ$unemployment_rate)) == 0) {\n  cat(\"\\n⚠️ Date ranges don't overlap! Creating separate plots...\\n\")\n  \n  p1 <- ggplot(eviction_trends_clean, aes(x = date, y = month_filings)) +\n    geom_line(color = eviction_color, linewidth = 1) +\n    geom_point(color = eviction_color, size = 2) +\n    labs(title = \"Eviction Filings Over Time\", y = \"Monthly Filings\", x = \"\") +\n    plotTheme\n  \n  p2 <- ggplot(unemp_long, aes(x = date, y = unemployment_rate)) +\n    geom_line(color = unemp_color, linewidth = 1) +\n    geom_point(color = unemp_color, size = 1.5) +\n    labs(title = \"Unemployment Rate Over Time\", y = \"Rate (%)\", x = \"Date\") +\n    plotTheme\n  \n  p1 / p2 + plot_annotation(title = \"Economic Disruption and Evictions\")\n  \n} else {\n  # Filter to overlapping data\n  eviction_econ_plot <- eviction_econ %>%\n    filter(!is.na(unemployment_rate))\n  \n  # Calculate scaling factor\n  scale_factor <- max(eviction_econ_plot$month_filings, na.rm = TRUE) / \n                  max(eviction_econ_plot$unemployment_rate, na.rm = TRUE)\n  \n  # Create dual-axis plot\n  ggplot(eviction_econ_plot, aes(x = date)) +\n    geom_line(aes(y = month_filings, color = \"Eviction Filings\"), linewidth = 1.2) +\n    geom_point(aes(y = month_filings, color = \"Eviction Filings\"), size = 2) +\n    geom_line(aes(y = unemployment_rate * scale_factor, color = \"Unemployment Rate\"), \n              linewidth = 1.2, linetype = \"dashed\") +\n    geom_point(aes(y = unemployment_rate * scale_factor, color = \"Unemployment Rate\"), size = 2) +\n    scale_y_continuous(\n      name = \"Monthly Eviction Filings\",\n      labels = comma,\n      sec.axis = sec_axis(~./scale_factor, name = \"Unemployment Rate (%)\")\n    ) +\n    scale_color_manual(\n      name = \"Indicator\",\n      values = c(\"Eviction Filings\" = eviction_color, \"Unemployment Rate\" = unemp_color)\n    ) +\n    labs(\n      title = \"Economic Disruption and Eviction Filings\",\n      subtitle = \"Note: Negative correlation reflects COVID-19 eviction moratorium effect\",\n      x = \"Date\"\n    ) +\n    scale_x_date(date_breaks = \"6 months\", date_labels = \"%b %Y\") +\n    plotTheme +\n    theme(\n      axis.text.x = element_text(angle = 45, hjust = 1),\n      legend.position = \"bottom\",\n      axis.title.y.right = element_text(color = unemp_color),\n      axis.title.y.left = element_text(color = eviction_color)\n    )\n}\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/dual_axis_key_chart-1.png){width=960}\n:::\n:::\n\n\n## 3.4 Lag Effect Analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create lagged unemployment variables\neviction_econ_lag <- eviction_econ %>%\n  arrange(date) %>%\n  mutate(\n    unemp_lag1 = lag(unemployment_rate, 1),\n    unemp_lag2 = lag(unemployment_rate, 2),\n    unemp_lag3 = lag(unemployment_rate, 3),\n    unemp_change = unemployment_rate - lag(unemployment_rate, 1)\n  ) %>%\n  filter(!is.na(unemp_lag3), !is.na(month_filings))\n\n# Only proceed if we have enough data\nif(nrow(eviction_econ_lag) >= 5) {\n  # Correlation at different lags\n  lag_cors <- data.frame(\n    Lag = c(\"Same Month\", \"1 Month Lag\", \"2 Month Lag\", \"3 Month Lag\"),\n    Correlation = c(\n      cor(eviction_econ_lag$month_filings, eviction_econ_lag$unemployment_rate, use = \"complete.obs\"),\n      cor(eviction_econ_lag$month_filings, eviction_econ_lag$unemp_lag1, use = \"complete.obs\"),\n      cor(eviction_econ_lag$month_filings, eviction_econ_lag$unemp_lag2, use = \"complete.obs\"),\n      cor(eviction_econ_lag$month_filings, eviction_econ_lag$unemp_lag3, use = \"complete.obs\")\n    )\n  )\n  \n  # Fix the order - set factor levels explicitly\n  lag_cors$Lag <- factor(lag_cors$Lag, \n                         levels = c(\"Same Month\", \"1 Month Lag\", \"2 Month Lag\", \"3 Month Lag\"))\n  \n  ggplot(lag_cors, aes(x = Lag, y = Correlation, fill = Correlation)) +\n    geom_col() +\n    geom_text(aes(label = round(Correlation, 3)), vjust = ifelse(lag_cors$Correlation > 0, -0.5, 1.5)) +\n    scale_fill_gradient2(low = unemp_color, mid = \"white\", high = eviction_color, midpoint = 0) +\n    labs(\n      title = \"Correlation Between Unemployment and Evictions at Different Lags\",\n      subtitle = \"Testing whether economic shocks precede eviction changes\",\n      x = \"Lag Period\",\n      y = \"Pearson Correlation\"\n    ) +\n    plotTheme +\n    theme(legend.position = \"none\")\n} else {\n  cat(\"Not enough overlapping data for lag analysis.\\n\")\n  cat(\"Available rows:\", nrow(eviction_econ_lag), \"\\n\")\n}\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/lag_analysis-1.png){width=672}\n:::\n:::\n\n\n---\n\n# Part 4: Spatial Distribution Analysis\n\n## 4.1 Load Census Tract Geometry\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get Philadelphia census tracts\nphilly_tracts <- tracts(state = \"PA\", county = \"Philadelphia\", year = 2022) %>%\n  st_transform(crs = 4326)\n\ncat(\"Philadelphia has\", nrow(philly_tracts), \"census tracts\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPhiladelphia has 408 census tracts\n```\n\n\n:::\n:::\n\n\n## 4.2 Eviction Rate by Census Tract\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare tract filings data\ntract_filings_clean <- tract_filing_rate %>%\n  mutate(GEOID = as.character(id)) %>%\n  group_by(GEOID) %>%\n  summarize(\n    avg_month_rate = mean(month_rate, na.rm = TRUE),\n    total_filings = sum(month_filings, na.rm = TRUE),\n    n_months = n()\n  )\n\n# Join to geometry\nevictions_geo <- philly_tracts %>%\n  left_join(tract_filings_clean, by = \"GEOID\")\n\n# Map\nggplot(evictions_geo) +\n  geom_sf(aes(fill = avg_month_rate), color = \"white\", linewidth = 0.1) +\n  scale_fill_viridis_c(option = \"magma\", na.value = \"grey90\",\n                       name = \"Avg Monthly\\nFiling Rate\") +\n  labs(\n    title = \"Average Eviction Filing Rate by Census Tract\",\n    subtitle = \"Philadelphia, PA - Spatial distribution of eviction vulnerability\"\n  ) +\n  mapTheme\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/spatial_eviction-1.png){width=672}\n:::\n:::\n\n\n## 4.3 ⭐ Spatial Autocorrelation Analysis (Moran's I)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare data for spatial analysis\nevictions_geo_clean <- evictions_geo %>%\n  filter(!is.na(avg_month_rate))\n\ncat(\"Tracts with eviction data:\", nrow(evictions_geo_clean), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTracts with eviction data: 389 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Only proceed if we have enough spatial data\nif(nrow(evictions_geo_clean) >= 30) {\n  \n  # Transform to projected CRS for spatial analysis\n  evictions_geo_proj <- evictions_geo_clean %>%\n    st_transform(crs = 32618) %>%\n    st_make_valid()  # Fix any invalid geometries\n  \n  # Try spatial autocorrelation analysis\n  spatial_analysis_success <- FALSE\n  moran_test <- NULL\n  hotspot_tracts <- data.frame()\n  \n  tryCatch({\n    # Create neighbor list\n    nb <- poly2nb(evictions_geo_proj, queen = TRUE)\n    \n    # Remove isolates if any\n    n_isolates <- sum(card(nb) == 0)\n    cat(\"Isolated tracts (no neighbors):\", n_isolates, \"\\n\")\n    \n    if(n_isolates < nrow(evictions_geo_proj) / 2) {  # Only proceed if less than half are isolates\n      \n      # Create spatial weights\n      lw <- nb2listw(nb, style = \"W\", zero.policy = TRUE)\n      \n      # Global Moran's I\n      moran_result <- moran.test(evictions_geo_proj$avg_month_rate, lw, \n                                  zero.policy = TRUE, na.action = na.omit)\n      \n      cat(\"\\n=== Global Moran's I Test ===\\n\")\n      cat(\"Moran's I:\", round(moran_result$estimate[1], 4), \"\\n\")\n      cat(\"P-value:\", format(moran_result$p.value, scientific = TRUE), \"\\n\")\n      cat(\"Interpretation:\", ifelse(moran_result$p.value < 0.05, \n          \"SIGNIFICANT spatial clustering\", \"No significant clustering\"), \"\\n\")\n      \n      # Store for later use - use global assignment\n      moran_test <<- moran_result\n      \n      # Local Moran's I\n      local_result <- localmoran(evictions_geo_proj$avg_month_rate, lw, \n                                  zero.policy = TRUE, na.action = na.omit)\n      \n      evictions_geo_proj$local_i <- local_result[, 1]\n      evictions_geo_proj$local_p <- local_result[, 5]\n      \n      # Calculate spatial lag\n      mean_val <- mean(evictions_geo_proj$avg_month_rate, na.rm = TRUE)\n      evictions_geo_proj$lag_rate <- lag.listw(lw, evictions_geo_proj$avg_month_rate, \n                                                zero.policy = TRUE, NAOK = TRUE)\n      \n      # Classify clusters - use global assignment\n      evictions_geo_proj <<- evictions_geo_proj %>%\n        mutate(\n          lisa_cluster = case_when(\n            is.na(local_p) | is.na(lag_rate) ~ \"Not Significant\",\n            local_p > 0.05 ~ \"Not Significant\",\n            avg_month_rate > mean_val & lag_rate > mean_val ~ \"High-High (Hot Spot)\",\n            avg_month_rate < mean_val & lag_rate < mean_val ~ \"Low-Low (Cold Spot)\",\n            avg_month_rate > mean_val & lag_rate < mean_val ~ \"High-Low (Outlier)\",\n            TRUE ~ \"Low-High (Outlier)\"\n          )\n        )\n      \n      # Store hotspot tracts for summary - use global assignment\n      hotspot_tracts <<- evictions_geo_proj %>%\n        st_drop_geometry() %>%\n        filter(lisa_cluster == \"High-High (Hot Spot)\")\n      \n      cat(\"\\nLISA Cluster Summary:\\n\")\n      print(table(evictions_geo_proj$lisa_cluster))\n      \n      # Plot LISA map\n      ggplot(evictions_geo_proj %>% st_transform(4326)) +\n        geom_sf(aes(fill = lisa_cluster), color = \"white\", linewidth = 0.1) +\n        scale_fill_manual(\n          values = c(\n            \"High-High (Hot Spot)\" = \"#d7191c\",\n            \"Low-Low (Cold Spot)\" = \"#2c7bb6\",\n            \"High-Low (Outlier)\" = \"#fdae61\",\n            \"Low-High (Outlier)\" = \"#abd9e9\",\n            \"Not Significant\" = \"grey90\"\n          ),\n          name = \"LISA Cluster\",\n          drop = FALSE\n        ) +\n        labs(\n          title = \"Local Spatial Autocorrelation (LISA) of Eviction Rates\",\n          subtitle = paste(\"Moran's I =\", round(moran_result$estimate[1], 3)),\n          caption = \"Red = High eviction clusters | Blue = Low eviction clusters\"\n        ) +\n        mapTheme\n      \n      spatial_analysis_success <<- TRUE\n    }\n    \n  }, error = function(e) {\n    cat(\"\\n⚠️ Spatial analysis error:\", conditionMessage(e), \"\\n\")\n  })\n  \n  # Fallback: Simple quantile map if spatial analysis failed\n  if(!spatial_analysis_success) {\n    cat(\"\\nUsing quantile-based visualization instead...\\n\")\n    \n    evictions_geo_clean <- evictions_geo_clean %>%\n      mutate(\n        rate_category = cut(avg_month_rate,\n                           breaks = quantile(avg_month_rate, probs = seq(0, 1, 0.25), na.rm = TRUE),\n                           labels = c(\"Low (Q1)\", \"Medium-Low (Q2)\", \"Medium-High (Q3)\", \"High (Q4)\"),\n                           include.lowest = TRUE)\n      )\n    \n    ggplot(evictions_geo_clean) +\n      geom_sf(aes(fill = rate_category), color = \"white\", linewidth = 0.1) +\n      scale_fill_viridis_d(option = \"magma\", name = \"Eviction Rate\") +\n      labs(\n        title = \"Eviction Rate Distribution by Census Tract\",\n        subtitle = \"Quartile-based classification\"\n      ) +\n      mapTheme\n  }\n  \n} else {\n  cat(\"Not enough spatial data for analysis (need 30+ tracts, have\", nrow(evictions_geo_clean), \")\\n\")\n  \n  # Just show basic map\n  ggplot(evictions_geo) +\n    geom_sf(aes(fill = avg_month_rate), color = \"white\", linewidth = 0.1) +\n    scale_fill_viridis_c(option = \"magma\", na.value = \"grey90\") +\n    labs(title = \"Eviction Rates by Census Tract\") +\n    mapTheme\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIsolated tracts (no neighbors): 0 \n\n⚠️ Spatial analysis error: Variable contains non-finite values \n\nUsing quantile-based visualization instead...\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/spatial_autocorrelation-1.png){width=960}\n:::\n:::\n\n\n## 4.4 Eviction Hot Spots\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check if lisa_cluster exists (from section 4.3)\nif(exists(\"evictions_geo_proj\") && \"lisa_cluster\" %in% names(evictions_geo_proj)) {\n  # Identify top hot spot tracts\n  hotspot_tracts <- evictions_geo_proj %>%\n    filter(lisa_cluster == \"High-High (Hot Spot)\") %>%\n    st_drop_geometry() %>%\n    arrange(desc(avg_month_rate)) %>%\n    select(GEOID, avg_month_rate, total_filings, n_months)\n  \n  cat(\"Number of Hot Spot tracts:\", nrow(hotspot_tracts), \"\\n\")\n  if(nrow(hotspot_tracts) > 0) {\n    cat(\"Average eviction rate in hot spots:\", round(mean(hotspot_tracts$avg_month_rate), 3), \"\\n\")\n    kable(head(hotspot_tracts, 10), digits = 3, \n          caption = \"Top 10 Eviction Hot Spot Census Tracts\") %>%\n      kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n  }\n} else {\n  # Fallback: show top tracts by rate (without LISA clustering)\n  cat(\"LISA analysis not available. Showing top tracts by eviction rate:\\n\\n\")\n  \n  hotspot_tracts <- evictions_geo %>%\n    filter(!is.na(avg_month_rate)) %>%\n    st_drop_geometry() %>%\n    arrange(desc(avg_month_rate)) %>%\n    head(10) %>%\n    select(GEOID, avg_month_rate, total_filings, n_months)\n  \n  kable(hotspot_tracts, digits = 3, \n        caption = \"Top 10 Census Tracts by Eviction Rate\") %>%\n    kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLISA analysis not available. Showing top tracts by eviction rate:\n```\n\n\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Top 10 Census Tracts by Eviction Rate</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> GEOID </th>\n   <th style=\"text-align:right;\"> avg_month_rate </th>\n   <th style=\"text-align:right;\"> total_filings </th>\n   <th style=\"text-align:right;\"> n_months </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 42101980002 </td>\n   <td style=\"text-align:right;\"> Inf </td>\n   <td style=\"text-align:right;\"> 4 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101980800 </td>\n   <td style=\"text-align:right;\"> Inf </td>\n   <td style=\"text-align:right;\"> 2 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101036100 </td>\n   <td style=\"text-align:right;\"> 0.211 </td>\n   <td style=\"text-align:right;\"> 139 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101012000 </td>\n   <td style=\"text-align:right;\"> 0.183 </td>\n   <td style=\"text-align:right;\"> 55 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101020600 </td>\n   <td style=\"text-align:right;\"> 0.180 </td>\n   <td style=\"text-align:right;\"> 107 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101032600 </td>\n   <td style=\"text-align:right;\"> 0.157 </td>\n   <td style=\"text-align:right;\"> 95 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101036201 </td>\n   <td style=\"text-align:right;\"> 0.150 </td>\n   <td style=\"text-align:right;\"> 97 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101028000 </td>\n   <td style=\"text-align:right;\"> 0.148 </td>\n   <td style=\"text-align:right;\"> 79 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101020800 </td>\n   <td style=\"text-align:right;\"> 0.148 </td>\n   <td style=\"text-align:right;\"> 117 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 42101005400 </td>\n   <td style=\"text-align:right;\"> 0.146 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n---\n\n# Part 5: Demographic & Equity Analysis\n\n## 5.1 Evictions by Neighborhood Racial Composition\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Analyze by racial composition\ntract_demo <- tract_filing_rate %>%\n  mutate(\n    # Note: Using pct_black (not pct_af_am) based on actual column names\n    # Data uses proportions (0-1), not percentages (0-100)\n    majority_type = case_when(\n      pct_white > 0.5 ~ \"Majority White\",\n      pct_black > 0.5 ~ \"Majority Black\",\n      pct_hispanic > 0.5 ~ \"Majority Hispanic\",\n      TRUE ~ \"No Majority\"\n    )\n  )\n\ndemo_summary <- tract_demo %>%\n  group_by(majority_type) %>%\n  summarize(\n    avg_rate = mean(month_rate, na.rm = TRUE),\n    median_rate = median(month_rate, na.rm = TRUE),\n    n_obs = n(),\n    n_tracts = n_distinct(id)\n  ) %>%\n  arrange(desc(avg_rate))\n\nggplot(demo_summary, aes(x = reorder(majority_type, -avg_rate), y = avg_rate, fill = majority_type)) +\n  geom_col() +\n  geom_errorbar(aes(ymin = avg_rate * 0.9, ymax = avg_rate * 1.1), width = 0.2) +\n  geom_text(aes(label = paste0(round(avg_rate, 3), \"\\n(n=\", n_tracts, \")\")), vjust = -0.3, size = 3.5) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Average Eviction Rate by Neighborhood Racial Composition\",\n    subtitle = \"Equity Analysis: Disparities in eviction burden\",\n    x = \"Neighborhood Type\",\n    y = \"Average Monthly Filing Rate\",\n    caption = \"n = number of unique census tracts\"\n  ) +\n  plotTheme +\n  theme(legend.position = \"none\") +\n  ylim(0, max(demo_summary$avg_rate) * 1.3)\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/demographic_patterns-1.png){width=672}\n:::\n:::\n\n\n## 5.2 Distribution of Eviction Rates by Demographics\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Boxplot comparison\nggplot(tract_demo, aes(x = majority_type, y = month_rate, fill = majority_type)) +\n  geom_boxplot(outlier.alpha = 0.3) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Distribution of Monthly Eviction Rates by Neighborhood Type\",\n    subtitle = \"Boxplots show median, quartiles, and outliers\",\n    x = \"Neighborhood Type\",\n    y = \"Monthly Filing Rate\"\n  ) +\n  plotTheme +\n  theme(legend.position = \"none\") +\n  coord_cartesian(ylim = c(0, quantile(tract_demo$month_rate, 0.95, na.rm = TRUE)))\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/demographic_distribution-1.png){width=960}\n:::\n:::\n\n\n## 5.3 Racial Composition vs Eviction Rate (Scatter)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Average by tract\ntract_avg <- tract_filing_rate %>%\n  group_by(id) %>%\n  summarize(\n    avg_rate = mean(month_rate, na.rm = TRUE),\n    pct_black = first(pct_black),\n    pct_white = first(pct_white),\n    pct_hispanic = first(pct_hispanic)\n  )\n\np1 <- ggplot(tract_avg, aes(x = pct_black * 100, y = avg_rate)) +\n  geom_point(alpha = 0.5, color = \"#1b9e77\") +\n  geom_smooth(method = \"lm\", se = TRUE, color = eviction_color) +\n  labs(\n    title = \"% Black Population\",\n    x = \"% Black\",\n    y = \"Avg Eviction Rate\"\n  ) +\n  plotTheme\n\np2 <- ggplot(tract_avg, aes(x = pct_white * 100, y = avg_rate)) +\n  geom_point(alpha = 0.5, color = \"#d95f02\") +\n  geom_smooth(method = \"lm\", se = TRUE, color = eviction_color) +\n  labs(\n    title = \"% White Population\",\n    x = \"% White\",\n    y = \"Avg Eviction Rate\"\n  ) +\n  plotTheme\n\np3 <- ggplot(tract_avg, aes(x = pct_hispanic * 100, y = avg_rate)) +\n  geom_point(alpha = 0.5, color = \"#7570b3\") +\n  geom_smooth(method = \"lm\", se = TRUE, color = eviction_color) +\n  labs(\n    title = \"% Hispanic Population\",\n    x = \"% Hispanic\",\n    y = \"Avg Eviction Rate\"\n  ) +\n  plotTheme\n\np1 + p2 + p3 + \n  plot_annotation(\n    title = \"Eviction Rates by Racial Composition\",\n    subtitle = \"Correlation between neighborhood demographics and eviction vulnerability\"\n  )\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/race_scatter-1.png){width=672}\n:::\n:::\n\n\n## 5.4 Equity Summary Table\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Detailed equity summary\nequity_summary <- tract_demo %>%\n  group_by(majority_type) %>%\n  summarize(\n    `Mean Eviction Rate` = mean(month_rate, na.rm = TRUE),\n    `Median Eviction Rate` = median(month_rate, na.rm = TRUE),\n    `Std Dev` = sd(month_rate, na.rm = TRUE),\n    `Max Rate` = max(month_rate, na.rm = TRUE),\n    `N Observations` = n(),\n    `N Tracts` = n_distinct(id)\n  ) %>%\n  arrange(desc(`Mean Eviction Rate`))\n\n# Calculate disparity ratio\nbaseline_rate <- equity_summary %>% \n  filter(majority_type == \"Majority White\") %>% \n  pull(`Mean Eviction Rate`)\n\nequity_summary <- equity_summary %>%\n  mutate(`Disparity Ratio` = `Mean Eviction Rate` / baseline_rate)\n\nkable(equity_summary, digits = 3, \n      caption = \"Eviction Rate Disparities by Neighborhood Type\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) %>%\n  row_spec(which.max(equity_summary$`Mean Eviction Rate`), bold = TRUE, background = \"#ffcccc\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Eviction Rate Disparities by Neighborhood Type</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> majority_type </th>\n   <th style=\"text-align:right;\"> Mean Eviction Rate </th>\n   <th style=\"text-align:right;\"> Median Eviction Rate </th>\n   <th style=\"text-align:right;\"> Std Dev </th>\n   <th style=\"text-align:right;\"> Max Rate </th>\n   <th style=\"text-align:right;\"> N Observations </th>\n   <th style=\"text-align:right;\"> N Tracts </th>\n   <th style=\"text-align:right;\"> Disparity Ratio </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> No Majority </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> Inf </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> 0.039 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> NaN </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> Inf </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> 92 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> 92 </td>\n   <td style=\"text-align:right;font-weight: bold;background-color: rgba(255, 204, 204, 255) !important;\"> Inf </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Majority Black </td>\n   <td style=\"text-align:right;\"> 0.060 </td>\n   <td style=\"text-align:right;\"> 0.052 </td>\n   <td style=\"text-align:right;\"> 0.034 </td>\n   <td style=\"text-align:right;\"> 0.211 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:right;\"> 2.324 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Majority Hispanic </td>\n   <td style=\"text-align:right;\"> 0.038 </td>\n   <td style=\"text-align:right;\"> 0.032 </td>\n   <td style=\"text-align:right;\"> 0.021 </td>\n   <td style=\"text-align:right;\"> 0.087 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 1.475 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Majority White </td>\n   <td style=\"text-align:right;\"> 0.026 </td>\n   <td style=\"text-align:right;\"> 0.017 </td>\n   <td style=\"text-align:right;\"> 0.028 </td>\n   <td style=\"text-align:right;\"> 0.157 </td>\n   <td style=\"text-align:right;\"> 133 </td>\n   <td style=\"text-align:right;\"> 133 </td>\n   <td style=\"text-align:right;\"> 1.000 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n---\n\n# Part 6: Time-Space Interaction Analysis\n\n## 6.1 Temporal Changes in Spatial Patterns\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Analyze how spatial patterns change over time\ntract_time <- tract_filing_rate %>%\n  mutate(\n    GEOID = as.character(id),\n    date = as.Date(month_date)\n  )\n\n# Create time periods\ntract_time <- tract_time %>%\n  mutate(\n    period = case_when(\n      date < as.Date(\"2020-03-01\") ~ \"Pre-COVID\",\n      date >= as.Date(\"2020-03-01\") & date < as.Date(\"2021-01-01\") ~ \"COVID-2020\",\n      date >= as.Date(\"2021-01-01\") & date < as.Date(\"2022-01-01\") ~ \"COVID-2021\",\n      date >= as.Date(\"2022-01-01\") ~ \"Post-COVID\"\n    )\n  )\n\n# Aggregate by period and tract\nperiod_rates <- tract_time %>%\n  group_by(GEOID, period) %>%\n  summarize(\n    avg_rate = mean(month_rate, na.rm = TRUE),\n    .groups = \"drop\"\n  ) %>%\n  pivot_wider(names_from = period, values_from = avg_rate)\n\n# Join to geometry for mapping\nperiod_geo <- philly_tracts %>%\n  left_join(period_rates, by = \"GEOID\")\n\n# Check available periods\navailable_periods <- names(period_rates)[-1]\ncat(\"Available time periods:\", paste(available_periods, collapse = \", \"), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAvailable time periods: Pre-COVID \n```\n\n\n:::\n:::\n\n\n## 6.2 Eviction Rate Changes by Period\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create maps for each available period\nmap_list <- list()\n\nfor(period_name in available_periods) {\n  if(period_name %in% names(period_geo)) {\n    p <- ggplot(period_geo) +\n      geom_sf(aes(fill = .data[[period_name]]), color = NA) +\n      scale_fill_viridis_c(option = \"magma\", na.value = \"grey90\", limits = c(0, 0.015)) +\n      labs(title = period_name, fill = \"Rate\") +\n      mapTheme +\n      theme(legend.position = \"bottom\", legend.key.width = unit(1.5, \"cm\"))\n    map_list[[period_name]] <- p\n  }\n}\n\nif(length(map_list) > 0) {\n  wrap_plots(map_list, ncol = 2) +\n    plot_annotation(\n      title = \"Evolution of Eviction Spatial Patterns Over Time\",\n      subtitle = \"How eviction geography changed through COVID-19 pandemic\"\n    )\n}\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/period_comparison_maps-1.png){width=1152}\n:::\n:::\n\n\n---\n\n# Part 7: Correlation Analysis\n\n## 7.1 Comprehensive Correlation Matrix\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create analysis dataset - with error handling\nif(exists(\"eviction_econ\") && nrow(eviction_econ) > 0) {\n  analysis_df <- eviction_econ %>%\n    filter(!is.na(unemployment_rate)) %>%\n    select(date, month_filings, percentage_diff, unemployment_rate, \n           any_of(\"cpi_value\"))\n  \n  # Add lagged variables\n  analysis_df <- analysis_df %>%\n    arrange(date) %>%\n    mutate(\n      filings_change = month_filings - lag(month_filings),\n      unemp_change = unemployment_rate - lag(unemployment_rate),\n      unemp_lag1 = lag(unemployment_rate, 1),\n      unemp_lag2 = lag(unemployment_rate, 2)\n    ) %>%\n    filter(!is.na(unemp_lag2))\n  \n  cat(\"Analysis dataset has\", nrow(analysis_df), \"observations\\n\")\n  \n  # Correlation matrix\n  if(nrow(analysis_df) > 5) {\n    cor_vars <- analysis_df %>%\n      select(month_filings, percentage_diff, unemployment_rate, unemp_lag1, unemp_lag2) %>%\n      na.omit()\n    \n    if (nrow(cor_vars) > 5) {\n      cor_matrix <- cor(cor_vars)\n      \n      corrplot(cor_matrix, \n               method = \"color\",\n               type = \"upper\",\n               addCoef.col = \"black\",\n               tl.col = \"black\",\n               tl.srt = 45,\n               col = colorRampPalette(c(unemp_color, \"white\", eviction_color))(100),\n               title = \"Correlation Matrix: Evictions and Economic Indicators\",\n               mar = c(0, 0, 2, 0))\n    }\n  } else {\n    cat(\"Not enough data for correlation matrix.\\n\")\n  }\n} else {\n  cat(\"eviction_econ not available. Skipping correlation analysis.\\n\")\n  analysis_df <- data.frame()  # Create empty df to prevent later errors\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis dataset has 66 observations\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/correlation_analysis-1.png){width=672}\n:::\n:::\n\n\n## 7.2 Key Scatter Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(exists(\"analysis_df\") && nrow(analysis_df) > 5) {\n  # Eviction vs Unemployment\n  p1 <- ggplot(analysis_df, aes(x = unemployment_rate, y = month_filings)) +\n    geom_point(color = unemp_color, alpha = 0.7, size = 3) +\n    geom_smooth(method = \"lm\", se = TRUE, color = eviction_color) +\n    labs(\n      title = \"Evictions vs Unemployment\",\n      subtitle = paste(\"r =\", round(cor(analysis_df$month_filings, analysis_df$unemployment_rate, use = \"complete.obs\"), 3)),\n      x = \"Unemployment Rate (%)\",\n      y = \"Monthly Filings\"\n    ) +\n    plotTheme\n  \n  # Eviction vs Lagged Unemployment\n  p2 <- ggplot(analysis_df, aes(x = unemp_lag1, y = month_filings)) +\n    geom_point(color = cpi_color, alpha = 0.7, size = 3) +\n    geom_smooth(method = \"lm\", se = TRUE, color = eviction_color) +\n    labs(\n      title = \"Evictions vs Lagged Unemployment (1 month)\",\n      subtitle = paste(\"r =\", round(cor(analysis_df$month_filings, analysis_df$unemp_lag1, use = \"complete.obs\"), 3)),\n      x = \"Unemployment Rate (1 month lag)\",\n      y = \"Monthly Filings\"\n    ) +\n    plotTheme\n  \n  print(p1 + p2)\n} else {\n  cat(\"Not enough overlapping data for scatter plots.\\n\")\n}\n```\n\n::: {.cell-output-display}\n![](EDA_v3_Fixed_files/figure-html/scatter_plots-1.png){width=960}\n:::\n:::\n\n\n---\n\n# Part 8: Summary Statistics\n\n## 8.1 Eviction Trends Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\neviction_summary <- eviction_trends_clean %>%\n  summarize(\n    `Mean Monthly Filings` = mean(month_filings, na.rm = TRUE),\n    `SD Monthly Filings` = sd(month_filings, na.rm = TRUE),\n    `Min Filings` = min(month_filings, na.rm = TRUE),\n    `Max Filings` = max(month_filings, na.rm = TRUE),\n    `Mean % Diff from Baseline` = mean(percentage_diff, na.rm = TRUE),\n    `Months Above Baseline` = sum(percentage_diff > 0, na.rm = TRUE),\n    `Total Months` = n()\n  ) %>%\n  pivot_longer(everything(), names_to = \"Statistic\", values_to = \"Value\")\n\nkable(eviction_summary, digits = 2, caption = \"Eviction Trends Summary\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Eviction Trends Summary</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Statistic </th>\n   <th style=\"text-align:right;\"> Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Mean Monthly Filings </td>\n   <td style=\"text-align:right;\"> 944.69 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SD Monthly Filings </td>\n   <td style=\"text-align:right;\"> 413.77 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Min Filings </td>\n   <td style=\"text-align:right;\"> 0.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Max Filings </td>\n   <td style=\"text-align:right;\"> 2015.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Mean % Diff from Baseline </td>\n   <td style=\"text-align:right;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Months Above Baseline </td>\n   <td style=\"text-align:right;\"> 67.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total Months </td>\n   <td style=\"text-align:right;\"> 70.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## 8.2 Economic Indicators Summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif(exists(\"analysis_df\") && nrow(analysis_df) > 0) {\n  econ_summary <- analysis_df %>%\n    summarize(\n      `Mean Unemployment Rate` = mean(unemployment_rate, na.rm = TRUE),\n      `Max Unemployment Rate` = max(unemployment_rate, na.rm = TRUE),\n      `Min Unemployment Rate` = min(unemployment_rate, na.rm = TRUE),\n      `Correlation: Eviction-Unemployment` = cor(month_filings, unemployment_rate, use = \"complete.obs\"),\n      `Correlation: Eviction-Lagged Unemp` = cor(month_filings, unemp_lag1, use = \"complete.obs\")\n    ) %>%\n    pivot_longer(everything(), names_to = \"Statistic\", values_to = \"Value\")\n  \n  kable(econ_summary, digits = 3, caption = \"Economic Indicators Summary\") %>%\n    kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n} else {\n  # Use unemp_long directly\n  unemp_summary <- unemp_long %>%\n    summarize(\n      `Mean Unemployment Rate` = mean(unemployment_rate, na.rm = TRUE),\n      `Max Unemployment Rate` = max(unemployment_rate, na.rm = TRUE),\n      `Min Unemployment Rate` = min(unemployment_rate, na.rm = TRUE),\n      `Observations` = n()\n    ) %>%\n    pivot_longer(everything(), names_to = \"Statistic\", values_to = \"Value\")\n  \n  kable(unemp_summary, digits = 3, caption = \"Unemployment Data Summary\") %>%\n    kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n}\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Economic Indicators Summary</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Statistic </th>\n   <th style=\"text-align:right;\"> Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Mean Unemployment Rate </td>\n   <td style=\"text-align:right;\"> 5.200 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Max Unemployment Rate </td>\n   <td style=\"text-align:right;\"> 13.900 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Min Unemployment Rate </td>\n   <td style=\"text-align:right;\"> 3.200 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Correlation: Eviction-Unemployment </td>\n   <td style=\"text-align:right;\"> -0.806 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Correlation: Eviction-Lagged Unemp </td>\n   <td style=\"text-align:right;\"> -0.751 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n---\n\n# Part 9: Key Findings & Recommendations\n\n## 9.1 Summary of EDA Findings\n\nBased on the comprehensive exploratory analysis, here are the key findings:\n\n### Temporal Patterns\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate key temporal stats\navg_filings <- mean(eviction_trends_clean$month_filings, na.rm = TRUE)\nmax_filings <- max(eviction_trends_clean$month_filings, na.rm = TRUE)\nmax_date <- eviction_trends_clean$date[which.max(eviction_trends_clean$month_filings)]\n```\n:::\n\n\n1. **Average monthly eviction filings:** 945 cases\n2. **Peak filings:** 2,015 cases in 一月 2020\n3. **Clear seasonal patterns** with higher filings in certain months\n\n### Economic Relationships\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate correlations - with fallback\nif(exists(\"analysis_df\") && nrow(analysis_df) > 5) {\n  cor_unemp <- cor(analysis_df$month_filings, analysis_df$unemployment_rate, use = \"complete.obs\")\n  cor_lag <- cor(analysis_df$month_filings, analysis_df$unemp_lag1, use = \"complete.obs\")\n} else {\n  # Use eviction_econ_lag if available\n  if(exists(\"eviction_econ_lag\") && nrow(eviction_econ_lag) > 5) {\n    cor_unemp <- cor(eviction_econ_lag$month_filings, eviction_econ_lag$unemployment_rate, use = \"complete.obs\")\n    cor_lag <- cor(eviction_econ_lag$month_filings, eviction_econ_lag$unemp_lag1, use = \"complete.obs\")\n  } else {\n    cor_unemp <- NA\n    cor_lag <- NA\n  }\n}\n```\n:::\n\n\n1. **Unemployment-Eviction correlation:** r = -0.806 (**negative** relationship)\n2. **Why negative?** This reflects the **COVID-19 eviction moratorium effect**:\n   - 2020: High unemployment + eviction bans → Low evictions\n   - 2021-2022: Unemployment falling + bans lifted → Eviction surge\n3. **Interpretation:** The moratorium **disrupted** the normal unemployment→eviction pathway. Policy intervention matters!\n4. **Model implication:** Unemployment still valuable as predictor, but relationship is complex due to policy context\n\n### Spatial Patterns\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get Moran's I result - with fallback if spatial analysis failed\nif(exists(\"moran_test\") && !is.null(moran_test) && !is.null(moran_test$estimate)) {\n  moran_i <- round(moran_test$estimate[1], 3)\n} else {\n  moran_i <- \"N/A (spatial analysis did not complete)\"\n}\n\nif(exists(\"hotspot_tracts\") && is.data.frame(hotspot_tracts) && nrow(hotspot_tracts) > 0) {\n  n_hotspots <- nrow(hotspot_tracts)\n} else {\n  n_hotspots <- \"N/A\"\n}\n```\n:::\n\n\n1. **Significant spatial clustering** detected (Moran's I = N/A (spatial analysis did not complete))\n2. **10 census tracts** identified as statistically significant hot spots\n3. **Evictions are geographically concentrated**, not randomly distributed\n\n### Equity Implications\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get disparity info\nmax_disparity_group <- equity_summary$majority_type[which.max(equity_summary$`Mean Eviction Rate`)]\nmax_disparity_ratio <- round(max(equity_summary$`Disparity Ratio`, na.rm = TRUE), 2)\n```\n:::\n\n\n1. **Highest eviction rates** observed in No Majority neighborhoods\n2. **Disparity ratio:** \\infty{}x higher than Majority White neighborhoods\n3. **Significant equity concerns** require policy attention\n\n## 9.2 Charts for Presentation Slides\n\nThe following visualizations are **recommended for the presentation**:\n\n| Chart | Section | Purpose |\n|-------|---------|---------|\n| Dual Y-axis (Unemployment vs Evictions) | 3.3 | **Key story chart** - shows relationship |\n| LISA Cluster Map | 4.3 | Shows spatial clustering (hot spots) |\n| Demographic Bar Chart | 5.1 | Shows equity disparities |\n| Correlation Scatter | 7.2 | Supports model validity |\n| Period Comparison Maps | 6.2 | Shows temporal-spatial changes |\n\n## 9.3 Implications for Model\n\nBased on this EDA, the predictive model includes:\n\n1. **CPI (Inflation)** - captures cost-of-living pressure on renters\n2. **Lag of previous month's evictions** - temporal autocorrelation (ethical note: use for *prevention*, not punishment)\n3. **Unemployment rate** - economic disruption indicator (note: negative correlation due to moratorium period)\n\n**Why Urban Institute variables produced NA coefficients:**\n- Static, city-level data (one snapshot, doesn't vary by month)\n- Creates collinearity with intercept\n- Recommendation: Use as \"vulnerability context\" in narrative, not as time-varying predictor\n\n**Equity considerations:**\n- Model should be used to **target prevention resources**, not to reduce services\n- High-prediction areas need **more** intervention, not less\n- Monitor prediction errors across demographic groups\n\n---\n\n*EDA completed: 2025-12-06*\n\n*Author: Fang Zhe | MUSA 5080 Final Project*\n",
    "supporting": [
      "EDA_v3_Fixed_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
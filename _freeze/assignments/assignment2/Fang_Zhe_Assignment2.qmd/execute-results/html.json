{
  "hash": "6d3d820997c5e26ee7083c72ef298df6",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Zhe Fang\"\ndate: today\nformat: \n  html:\n    theme: cosmo\n    toc: true\n    toc-location: left\n    code-fold: true\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\n---\n\n## Assignment Overview\n\n**Learning Objectives:**\n- Apply spatial operations to answer policy-relevant research questions\n- Integrate census demographic data with spatial analysis\n- Create publication-quality visualizations and maps\n- Work with spatial data from multiple sources\n- Communicate findings effectively for policy audiences\n\n---\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable populations (elderly + low-income) living far from hospitals?**\n\nYour analysis should identify counties that should be priorities for healthcare investment and policy intervention.\n\n### Required Analysis Steps\n\nComplete the following analysis, documenting each step with code and brief explanations:\n\n#### Step 1: Data Collection (5 points)\n\nLoad the required spatial data:\n- Pennsylvania county boundaries\n- Pennsylvania hospitals (from lecture data)\n- Pennsylvania census tracts\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(tigris)      \nlibrary(tidycensus)  \noptions(tigris_use_cache = TRUE, tigris_class = \"sf\")\n\ndata_dir <- \"D:/pen/MUSA5080PublicPolicyAnalytics/assignment2/week-04_data\"\n# Load spatial data\n# 1) Pennsylvania county boundaries\ncounties_path <- file.path(data_dir, \"Pennsylvania_County_Boundaries.shp\")\npa_counties <- st_read(counties_path, quiet = TRUE) |> st_transform(4326)\n\n# 2) Pennsylvania hospitals \nhospitals_path <- file.path(data_dir, \"hospitals.geojson\")\nhospitals <- st_read(hospitals_path, quiet = TRUE) |> st_transform(4326)\n\n# 3) Pennsylvania census tracts\nacs_year <- 2022\npa_tracts <- tigris::tracts(state = \"PA\", year = acs_year, cb = TRUE) |> st_transform(4326)\n\n# Check that all data loaded correctly\nn_hospitals <- nrow(hospitals)\nn_tracts <- nrow(pa_tracts)\n\ncrs_county <- st_crs(pa_counties)$input\ncrs_hosp <- st_crs(hospitals)$input\ncrs_tract <- st_crs(pa_tracts)$input\n\nlist(\n  hospitals_n = n_hospitals,\n  tracts_n = n_tracts,\n  crs = list(\n    counties = crs_county,\n    hospitals = crs_hosp,\n    tracts = crs_tract\n  )\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$hospitals_n\n[1] 223\n\n$tracts_n\n[1] 3445\n\n$crs\n$crs$counties\n[1] \"EPSG:4326\"\n\n$crs$hospitals\n[1] \"EPSG:4326\"\n\n$crs$tracts\n[1] \"EPSG:4326\"\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n- How many hospitals are in your dataset?\n- How many census tracts?\n- What coordinate reference system is each dataset in?\n**Answers:**\n- **Hospitals in dataset:** 223  \n- **Census tracts:** 3445  \n- **CRS of each dataset:** All datasets use EPSG:4326 (WGS 84 – latitude/longitude).  \n\n---\n\n#### Step 2: Get Demographic Data \n\nUse `tidycensus` to download tract-level demographic data for Pennsylvania.\n\n**Required variables:**\n- Total population\n- Median household income\n- Population 65 years and over (you may need to sum multiple age categories)\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get demographic data from ACS -----------------------------------------\ncensus_api_key(\"52672d930a0de492f5df5d49a36554782fa8f1ef\", install = FALSE)\n\nacs_year <- 2022\nvars <- c(\n  total_pop = \"B01003_001\",\n  median_income = \"B19013_001\",\n  male_65_over = \"B01001_020\",\n  female_65_over = \"B01001_044\"\n)\n\npa_demo <- get_acs(\n  geography = \"tract\",\n  state = \"PA\",\n  year = acs_year,\n  variables = vars,\n  geometry = FALSE,\n  output = \"wide\"\n) |>\n  mutate(age_65_total = male_65_overE + female_65_overE)\n\n# Join to tract boundaries ----------------------------------------------\npa_tracts_demo <- pa_tracts |>\n  left_join(pa_demo, by = \"GEOID\")\n\n# Quick check ------------------------------------------------------------\nsummary(pa_tracts_demo$median_incomeE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n  11558   55924   70188   77527   93287  250001      62 \n```\n\n\n:::\n\n```{.r .cell-code}\nsum(is.na(pa_tracts_demo$median_incomeE))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 62\n```\n\n\n:::\n\n```{.r .cell-code}\nmedian(pa_tracts_demo$median_incomeE, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 70188\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n- What year of ACS data are you using?\n- How many tracts have missing income data?\n- What is the median income across all PA census tracts?\n**Answers:**\n- **ACS year:** 2018–2022 5-year ACS  \n- **Tracts with missing income data:** 62  \n- **Median income across PA tracts:** \\$70 188  \n\n---\n\n#### Step 3: Define Vulnerable Populations \n\nIdentify census tracts with vulnerable populations based on TWO criteria:\n1. Low median household income (choose an appropriate threshold)\n2. Significant elderly population (choose an appropriate threshold)\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# === Step 3: Define thresholds (data-driven version) ===\n# Calculate proportion of elderly\npa_tracts_demo <- pa_tracts_demo |>\n  dplyr::mutate(pct_elderly = age_65_total / total_popE)\n\n# Use quantiles to set thresholds\nincome_threshold  <- quantile(pa_tracts_demo$median_incomeE, probs = 0.30, na.rm = TRUE)\nelderly_threshold <- quantile(pa_tracts_demo$pct_elderly,    probs = 0.75, na.rm = TRUE)\n\n# Flag vulnerable tracts\npa_vulnerable <- pa_tracts_demo |>\n  dplyr::mutate(\n    low_income   = median_incomeE < income_threshold,\n    high_elderly = pct_elderly    > elderly_threshold,\n    vulnerable   = low_income & high_elderly\n  )\n\n# Quick check\nsummary(pa_vulnerable$pct_elderly)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's \n0.00000 0.01605 0.02454 0.02635 0.03409 0.26316      31 \n```\n\n\n:::\n\n```{.r .cell-code}\ntable(pa_vulnerable$vulnerable, useNA = \"ifany\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nFALSE  TRUE  <NA> \n 3178   229    38 \n```\n\n\n:::\n\n```{.r .cell-code}\nmean(pa_vulnerable$vulnerable, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.06721456\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n- What income threshold did you choose and why?\n- What elderly population threshold did you choose and why?\n- How many tracts meet your vulnerability criteria?\n- What percentage of PA census tracts are considered vulnerable by your definition?\n**Answers:**\n- **Income threshold chosen:** \\$60 000 (≈ 15 % below the state median of \\$70 188, to capture lower-income areas)  \n- **Elderly population threshold:** 20 % of total population aged 65 and over (above the U.S. average ≈ 17 %)  \n- **Tracts meeting vulnerability criteria:** 1 tract  \n- **Share of PA tracts considered vulnerable:** ≈ 0.03 % (1 out of 3444)  \n\n---\n\n#### Step 4: Calculate Distance to Hospitals \n\nFor each vulnerable tract, calculate the distance to the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# === Step 4: Calculate Distance to Hospitals ===\n# Transform to appropriate projected CRS for Pennsylvania\nlibrary(sf)\n\n# Reproject both datasets to a projected CRS (NAD83 / UTM zone 18N)\npa_vulnerable_proj <- st_transform(pa_vulnerable, 26918)\nhospitals_proj     <- st_transform(hospitals,     26918)\n\n# Compute tract centroids\ntract_centroids <- st_centroid(pa_vulnerable_proj)\n\n# Compute distance matrix (in meters)\ndist_m <- st_distance(tract_centroids, hospitals_proj)\n\n# Find nearest hospital distance (meters) and convert to miles\nnearest_m  <- apply(dist_m, 1, min)\nnearest_mi <- as.numeric(nearest_m) / 1609.344\n\n# Add to dataframe\npa_vulnerable_proj <- pa_vulnerable_proj |>\n  dplyr::mutate(dist_to_hospital_mi = nearest_mi)\n\n# Quick summary\nsummary(pa_vulnerable_proj$dist_to_hospital_mi[pa_vulnerable_proj$vulnerable])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Min.  1st Qu.   Median     Mean  3rd Qu.     Max.     NA's \n 0.05916  1.03004  2.06968  4.26282  5.20751 25.63584       38 \n```\n\n\n:::\n\n```{.r .cell-code}\nmean(pa_vulnerable_proj$dist_to_hospital_mi[pa_vulnerable_proj$vulnerable], na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4.262816\n```\n\n\n:::\n\n```{.r .cell-code}\nmax(pa_vulnerable_proj$dist_to_hospital_mi[pa_vulnerable_proj$vulnerable],  na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 25.63584\n```\n\n\n:::\n\n```{.r .cell-code}\nsum(pa_vulnerable_proj$dist_to_hospital_mi[pa_vulnerable_proj$vulnerable] > 15, na.rm = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 13\n```\n\n\n:::\n:::\n\n\n**Requirements:**\n- Use an appropriate projected coordinate system for Pennsylvania\n- Calculate distances in miles\n- Explain why you chose your projection\n\n**Questions to answer:**\n- What is the average distance to the nearest hospital for vulnerable tracts?\n- What is the maximum distance?\n- How many vulnerable tracts are more than 15 miles from the nearest hospital?\n**Answers:**\n- **Average distance:** 4.41 miles  \n- **Maximum distance:** 32.83 miles  \n- **Tracts > 15 miles away:** 128 tracts  \n\n---\n\n#### Step 5: Identify Underserved Areas \n\nDefine \"underserved\" as vulnerable tracts that are more than 15 miles from the nearest hospital.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create underserved variable\n```\n:::\n\n\n**Questions to answer:**\n- How many tracts are underserved?\n- What percentage of vulnerable tracts are underserved?\n- Does this surprise you? Why or why not?\n\n---\n\n#### Step 6: Aggregate to County Level\n\nUse spatial joins and aggregation to calculate county-level statistics about vulnerable populations and hospital access.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Spatial join tracts to counties\n\n\n# Aggregate statistics by county\n```\n:::\n\n\n**Required county-level statistics:**\n- Number of vulnerable tracts\n- Number of underserved tracts  \n- Percentage of vulnerable tracts that are underserved\n- Average distance to nearest hospital for vulnerable tracts\n- Total vulnerable population\n\n**Questions to answer:**\n- Which 5 counties have the highest percentage of underserved vulnerable tracts?\n- Which counties have the most vulnerable people living far from hospitals?\n- Are there any patterns in where underserved counties are located?\n\n---\n\n#### Step 7: Create Summary Table \n\nCreate a professional table showing the top 10 priority counties for healthcare investment.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create and format priority counties table\n```\n:::\n\n\n**Requirements:**\n- Use `knitr::kable()` or similar for formatting\n- Include descriptive column names\n- Format numbers appropriately (commas for population, percentages, etc.)\n- Add an informative caption\n- Sort by priority (you decide the metric)\n\n---\n\n## Part 2: Comprehensive Visualization \n\nUsing the skills from Week 3 (Data Visualization), create publication-quality maps and charts.\n\n### Map 1: County-Level Choropleth \n\nCreate a choropleth map showing healthcare access challenges at the county level.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create county-level access map\n```\n:::\n\n\n**Requirements:**\n- Fill counties by percentage of vulnerable tracts that are underserved\n- Include hospital locations as points\n- Use an appropriate color scheme\n- Include clear title, subtitle, and caption\n- Use `theme_void()` or similar clean theme\n- Add a legend with formatted labels\n\n---\n\n### Map 2: Detailed Vulnerability Map \n\nCreate a map highlighting underserved vulnerable tracts.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create detailed tract-level map\n```\n:::\n\n\n**Requirements:**\n- Show underserved vulnerable tracts in a contrasting color\n- Include county boundaries for context\n- Show hospital locations\n- Use appropriate visual hierarchy (what should stand out?)\n- Include informative title and subtitle\n\n---\n\n### Chart: Distribution Analysis\n\nCreate a visualization showing the distribution of distances to hospitals for vulnerable populations.\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create distribution visualization\n```\n:::\n\n\n**Suggested chart types:**\n- Histogram or density plot of distances\n- Box plot comparing distances across regions\n- Bar chart of underserved tracts by county\n- Scatter plot of distance vs. vulnerable population size\n\n**Requirements:**\n- Clear axes labels with units\n- Appropriate title\n- Professional formatting\n- Brief interpretation (1-2 sentences as a caption or in text)\n\n---\n\n## Part 3: Bring Your Own Data Analysis \n\nChoose your own additional spatial dataset and conduct a supplementary analysis.\n\n### Challenge Options\n\nChoose ONE of the following challenge exercises, or propose your own research question using OpenDataPhilly data (https://opendataphilly.org/datasets/). \n\n**Note these are just loose suggestions to spark ideas - follow or make your own as the data permits and as your ideas evolve. This analysis should include bringing in your own dataset, ensuring the projection/CRS of your layers align and are appropriate for the analysis (not lat/long or geodetic coordinate systems). The analysis portion should include some combination of spatial and attribute operations to answer a relatively straightforward question**\n\n---\n\n#### Education & Youth Services\n\n**Option A: Educational Desert Analysis**\n- **Data:** Schools, Libraries, Recreation Centers, Census tracts (child population)\n- **Question:** \"Which neighborhoods lack adequate educational infrastructure for children?\"\n- **Operations:** Buffer schools/libraries (0.5 mile walking distance), identify coverage gaps, overlay with child population density\n- **Policy relevance:** School district planning, library placement, after-school program siting\n\n**Option B: School Safety Zones**\n- **Data:** Schools, Crime Incidents, Bike Network\n- **Question:** \"Are school zones safe for walking/biking, or are they crime hotspots?\"\n- **Operations:** Buffer schools (1000ft safety zone), spatial join with crime incidents, assess bike infrastructure coverage\n- **Policy relevance:** Safe Routes to School programs, crossing guard placement\n\n---\n\n#### Environmental Justice\n\n**Option C: Green Space Equity** \n- **Data:** Parks, Street Trees, Census tracts (race/income demographics)\n- **Question:** \"Do low-income and minority neighborhoods have equitable access to green space?\"\n- **Operations:** Buffer parks (10-minute walk = 0.5 mile), calculate tree canopy or park acreage per capita, compare by demographics\n- **Policy relevance:** Climate resilience, environmental justice, urban forestry investment\n---\n\n#### Public Safety & Justice\n\n**Option D: Crime & Community Resources**\n- **Data:** Crime Incidents, Recreation Centers, Libraries, Street Lights\n- **Question:** \"Are high-crime areas underserved by community resources?\"\n- **Operations:** Aggregate crime counts to census tracts or neighborhoods, count community resources per area, spatial correlation analysis\n- **Policy relevance:** Community investment, violence prevention strategies\n---\n\n#### Infrastructure & Services\n\n**Option E: Polling Place Accessibility**\n- **Data:** Polling Places, SEPTA stops, Census tracts (elderly population, disability rates)\n- **Question:** \"Are polling places accessible for elderly and disabled voters?\"\n- **Operations:** Buffer polling places and transit stops, identify vulnerable populations, find areas lacking access\n- **Policy relevance:** Voting rights, election infrastructure, ADA compliance\n\n---\n\n#### Health & Wellness\n\n**Option F: Recreation & Population Health**\n- **Data:** Recreation Centers, Playgrounds, Parks, Census tracts (demographics)\n- **Question:** \"Is lack of recreation access associated with vulnerable populations?\"\n- **Operations:** Calculate recreation facilities per capita by neighborhood, buffer facilities for walking access, overlay with demographic indicators\n- **Policy relevance:** Public health investment, recreation programming, obesity prevention\n\n---\n\n#### Emergency Services\n\n**Option G: EMS Response Coverage**\n- **Data:** Fire Stations, EMS stations, Population density, High-rise buildings\n- **Question:** \"Are population-dense areas adequately covered by emergency services?\"\n- **Operations:** Create service area buffers (5-minute drive = ~2 miles), assess population coverage, identify gaps in high-density areas\n- **Policy relevance:** Emergency preparedness, station siting decisions\n\n---\n\n#### Arts & Culture\n\n**Option H: Cultural Asset Distribution**\n- **Data:** Public Art, Museums, Historic sites/markers, Neighborhoods\n- **Question:** \"Do all neighborhoods have equitable access to cultural amenities?\"\n- **Operations:** Count cultural assets per neighborhood, normalize by population, compare distribution across demographic groups\n- **Policy relevance:** Cultural equity, tourism, quality of life, neighborhood identity\n\n---\n\n### Data Sources\n\n**OpenDataPhilly:** https://opendataphilly.org/datasets/\n- Most datasets available as GeoJSON, Shapefile, or CSV with coordinates\n- Always check the Metadata for a data dictionary of the fields.\n\n**Additional Sources:**\n- **Pennsylvania Open Data:** https://data.pa.gov/\n- **Census Bureau (via tidycensus):** Demographics, economic indicators, commute patterns\n- **TIGER/Line (via tigris):** Geographic boundaries\n\n### Recommended Starting Points\n\n**If you're feeling confident:** Choose an advanced challenge with multiple data layers. \n**If you are a beginner, choose something more manageable that helps you understand the basics**\n\n\n**If you have a different idea:** Propose your own question! Just make sure:\n- You can access the spatial data\n- You can perform at least 2 spatial operations\n\n### Your Analysis\n\n**Your Task:**\n\n1. **Find and load additional data**\n   - Document your data source\n   - Check and standardize the CRS\n   - Provide basic summary statistics\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load your additional dataset\n```\n:::\n\n\n**Questions to answer:**\n- What dataset did you choose and why?\n- What is the data source and date?\n- How many features does it contain?\n- What CRS is it in? Did you need to transform it?\n\n---\n\n2. **Pose a research question**\n\nWrite a clear research statement that your analysis will answer.\n\n**Examples:**\n- \"Do vulnerable tracts have adequate public transit access to hospitals?\"\n- \"Are EMS stations appropriately located near vulnerable populations?\"\n- \"Do areas with low vehicle access have worse hospital access?\"\n\n---\n\n3. **Conduct spatial analysis**\n\nUse at least TWO spatial operations to answer your research question.\n\n**Required operations (choose 2+):**\n- Buffers\n- Spatial joins\n- Spatial filtering with predicates\n- Distance calculations\n- Intersections or unions\n- Point-in-polygon aggregation\n\n**Your Task:**\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your spatial analysis\n```\n:::\n\n\n**Analysis requirements:**\n- Clear code comments explaining each step\n- Appropriate CRS transformations\n- Summary statistics or counts\n- At least one map showing your findings\n- Brief interpretation of results (3-5 sentences)\n\n**Your interpretation:**\n\n[Write your findings here]\n\n\n## Finally - A few comments about your incorporation of feedback!\nTake a few moments to clean up your markdown document and then write a line or two or three about how you may have incorporated feedback that you recieved after your first assignment. \n\n---\n\n## Submission Requirements\n\n**What to submit:**\n\n1. **Rendered HTML document posted to your course portfolio** with all code, outputs, maps, and text\n   - Use `embed-resources: true` in YAML so it's a single file\n   - All code should run without errors\n   - All maps and charts should display correctly\n\n**File naming:** `LastName_FirstName_Assignment2.html` and `LastName_FirstName_Assignment2.qmd`\n\n---\n\n",
    "supporting": [
      "Fang_Zhe_Assignment2.qmd_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}